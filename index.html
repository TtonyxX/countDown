<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="favicon.png" />

    <!-- mdl lite -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.light_green-lime.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="styles.css"
    />

    <title>Countdown</title>
  </head>


  <body>
    <center><p id="header"></p></center>

    <div id="test-toggle">
      <p>ACT</p>
      <div style="margin-left: 4px; margin-right: 10px;">
        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect arrow" for="switch">
          <input type="checkbox" id="switch" class="mdl-switch__input" checked>
          <span class="mdl-switch__label"></span>
        </label>
      </div>
      <p>SAT</p>
    </div>

    <div id="clock"></div>
    <div id="units">
      <span>Days</span>
      <span>Hours</span>
      <span>Minutes</span>
      <span>Seconds</span>
    </div>

    <center style="margin-top: 35vh;">
      <button
        class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored arrow"
        onclick="left()"
      >
        <i class="fas fa-arrow-left"></i>
      </button>

      <button
        class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored arrow"
        onclick="right()"
      >
        <i class="fas fa-arrow-right"></i>
      </button>
    </center>

    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="countdown.js"></script>

    <script>
      var satDates = ["August 24, 2019 7:50:00", "October 5, 2019 7:50:00", "November 2, 2019 7:50:00", "December 7, 2019 7:50:00"];
      var actDates = ["September 14, 2019 7:50:00", "October 26, 2019 7:50:00", "December 14, 2019 7:50:00"];
      var selectedTest = "SAT";
      var dates = satDates;
      var currentIndex = 0;
      var countDownDate;

      if(localStorage.test == "act") {
        dates = actDates;
        selectedTest = "ACT";
        $("#switch").prop('checked', false); 
        $('#switch').data('checked', "1");
      }

      if(localStorage.currentIndex != null) {
        currentIndex = localStorage.currentIndex;
      }

      function countDown() {
        countDownDate = new Date(dates[currentIndex]);
        startTimer("clock", countDownDate);
        $("#header").html(dates[currentIndex].split(" ")[0] + " " + selectedTest);

        // Get todays date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor(
          (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // If the count down is over
        if (distance < 0) {
          dates.shift();
          countDownDate = new Date(dates[0]).getTime();
          countDown();
          stopTimer();
        }
      }

      window.onload = () => {
        countDown();
      };

      function right() {
        if (currentIndex + 1 < dates.length) {
          currentIndex++;
          localStorage.currentIndex = currentIndex;
          $("#header").html(dates[currentIndex].split(" ")[0] + " " + selectedTest);
          stopTimer();
          countDown();
        }
      }

      function left() {
        if (currentIndex - 1 >= 0) {
          currentIndex--;
          localStorage.currentIndex = currentIndex;
          $("#header").html(dates[currentIndex].split(" ")[0] + " " + selectedTest);
          stopTimer();
          countDown();
        }
      }

      $('#switch').change(function() {
        if ($('#switch').data('checked') == "1") {
          $('#switch').data('checked', "0");
          localStorage.test = "sat";
          selectedTest = "SAT";
          dates = satDates;
          currentIndex = 0;
          stopTimer();
          countDown();
        } else {
          $('#switch').data('checked', "1");
          localStorage.test = "act";
          selectedTest = "ACT";
          dates = actDates;
          currentIndex = 0;
          stopTimer();
          countDown();
        }
      });
    </script>
  </body>
</html>
